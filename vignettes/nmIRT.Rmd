---
title: "nmIRT"
author: "Rikard Nordgren"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{nmIRT}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

nmIRT as an R package for generation and diagnostics of IRT NONMEM models.

## Scales

A scale object is a representation in R of a certain scale. It is a collection of items that each has an item number, a type (currently only ordered categorical is supported) and a set of levels. A scale object can be created in multiple ways. 

### Using a built in scale

```{r, fig.show='hold'}
library(nmIRT)
scale <- predefined_scale("MDS-UPDRS")
```

### Generating a scale from a data.frame
```{r, fig.show='hold'}
df <- data.frame(ID=c(1,1,1,2,2,2), ITEM=c(1,2,3,1,2,3), DV=c(0,2,4,1,2,1))
scale <- scale_from_dataset(df)
```

By default the item column is called ITEM and the dv column is called DV, but this can be changed with options
```{r, eval=FALSE, fig.show='hold'}
scale <- scale_from_dataset(df, item='ITEM', dv='DV')
```

Note that if the dataset has an MDV column it will be used to filter out missing DVs.

A summary of the scale can be displayed with
```{r, fig.show='hold'}
str(scale)
```
Note that what is displayed here is the internal structure of the scale object and that it can be subject to change.


### Generating a scale from a dataset file
```{r, eval=FALSE, fig.show='hold'}
scale <- scale_from_dataset("mydata.csv")
```

## Creating a model object from a scale
```{r, fig.show='hold'}
model <- irt_model(scale)
```

## Using a base scale for a model
A model can have one scale and one base_scale. By default they are the same, but in some cases it is of benefit to use the base scale. A base scale is the scale from which the ordinary scale was derived. Let us say that you are using a predefined scale, but are modifing it in some way, for example by removing items. Then the base scale would still be the full scale allowing the model generation procedure to put placeholders for the missing items.
```{r}
base_scale <- predefined_scale("MDS-UPDRS")
scale <- remove_item(base_scale, 14) # This will remove item number 14
model <- irt_model(scale, base_scale)
```

## Attach a dataset to a model
```{r, eval=FALSE}
model <- add_dataset(model, "my.dta")
```

## Generate the NONMEM code from a model object
```{r, fig.show='hold'}
scale <- scale_from_dataset(df)
model <- irt_model(scale)
print_model(model)
```

## Write the NONMEM code to a file
```{r, eval=FALSE}
save_model(model, "run1.mod")
```
